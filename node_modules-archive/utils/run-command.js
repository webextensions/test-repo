/* eslint-env node */

var spawnCP = require('child_process').spawn;

var spawn = async function (cmd, args = [], options = {}) {
    return new Promise(function (resolve, reject) {
        var cwd = options.cwd || process.cwd();
        options.cwd = cwd;
        console.log(
            (function () {
                return ('(' + cwd + ') ');
            }()) +
            '$ ' + cmd + ' ' + args.join(' ')
        );

        var childProcess = spawnCP(cmd, args, options);
        childProcess.stdout.pipe(process.stdout);
        
        childProcess.on('exit', function(exitCode) {
            if (resolve) {
                resolve(exitCode);
            }
        });
    });
};

module.exports = {
    spawn
};
